<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Candan A.Åž</title>
  <link rel="stylesheet" type="text/css" rel="noopener" href="./static/css/signin.css">
</head>
<script>
  function exportToJSON() {
    const usernameInput = document.getElementById("usernameSignUp").value;
    const passwordInput = document.getElementById("passwordSignUp").value;
    const emailInput = document.getElementById("emailSignUp").value;
    const postRequestURL = document.getElementById("callback").value;
    const signupURL = document.getElementById("signupURL").value;
    const signinURL = document.getElementById("signinURL").value;
    console.log(postRequestURL);
    fetch(postRequestURL, {
      method: 'POST',
      headers: {
        'content-type': 'application/json'
      },
      'body': JSON.stringify({"username": usernameInput, "password": passwordInput, "email": emailInput})
    }).then((response) => response.json())
            .then((data) => {
              if (data["status"] === "success") {
                window.location.href = signinURL;
              } else if (data["status"] === "failed") {
                alert("Username or email already exists");
                window.location.href = signupURL;
              }
            });
  }
</script>
<body>
<!-- create a simple form to collect username and password, creates a json and sends it to http://localhost:6969/callback -->
<iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>
{{ $callback := .CallbackURL }}
{{ $signupURL := .SignupURL }}
{{ $signinURL := .SigninURL }}
<div class="login">
  <h1>Register</h1>
  <h5>Username's minimum length must be 8, wtih maximum length of 25.</h5>
  <h5>Password's minimum length must be 8, with maximum length of 16.</h5>
  <form method="post" action="" onsubmit="exportToJSON()" target="dummyframe">
    <input type="hidden" id="callback" value="{{ $callback }}">
    <input type="hidden" id="signupURL" value="{{ $signupURL }}">
    <input type="hidden" id="signinURL" value="{{ $signinURL }}">
    <label for="usernameSignUp"></label><input type="text" id="usernameSignUp" name="u" placeholder="Username" required="required" minlength="8" maxlength="25"/>
    <label for="passwordSignUp"></label><input type="password" id="passwordSignUp" name="p" placeholder="Password" required="required" minlength="8" maxlength="16" />
    <label for="emailSignUp"></label><input type="email" id="emailSignUp" name="e" placeholder="Email" required="required" />
    <button type="submit" class="btn btn-primary btn-block btn-large">Sign Up</button>
  </form>
  <form method="get" action="{{ .SigninURL }}">
    <button type="submit" class="btn btn-primary btn-block btn-large">Already registered?</button>
  </form>
</div>
</body>
</html>